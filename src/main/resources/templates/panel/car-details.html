<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>SzczegÃ³Å‚y samochodu</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 6px;
        }
        .ACTIVE {
            background-color: #e6ffe6;
        }
        .FINISHED {
            background-color: #f4f4f4;
        }
    </style>
</head>
<body>

<nav style="margin-bottom:15px;">
    <a href="/panel/cars">ğŸš— Samochody</a> |
    <a href="/panel/customers">ğŸ‘¤ Klienci</a> |
    <a href="/panel/rentals">ğŸ“„ WypoÅ¼yczenia</a>
</nav>

<hr>

<h1>ğŸš— SzczegÃ³Å‚y samochodu</h1>

<p><b>Marka:</b> <span th:text="${car.brand}"></span></p>
<p><b>Model:</b> <span th:text="${car.model}"></span></p>
<p><b>Rejestracja:</b> <span th:text="${car.plateNumber}"></span></p>
<p><strong>Rok produkcji:</strong> <span th:text="${car.year}"></span></p>
<p><b>VIN:</b> <span th:text="${car.vin}"></span></p>
<p><b>Status:</b> <span th:text="${car.status}"></span></p>

<hr>

<h2>ğŸ“„ Aktualne wypoÅ¼yczenie</h2>

<div th:if="${#lists.isEmpty(rentals)}">
    <p>Brak wypoÅ¼yczeÅ„ dla tego samochodu.</p>
</div>

<div th:each="r : ${rentals}" th:if="${!r.returned}">
    <p><b>Klient:</b>
        <span th:text="${r.customer.firstName}"></span>
        <span th:text="${r.customer.lastName}"></span>
    </p>

    <p><b>Rodzaj wynajmu:</b> <span th:text="${r.rentalType}"></span></p>

    <p th:if="${r.rentalType.name() == 'SHORT_TERM'}">
        <b>Cena za dobÄ™:</b> <span th:text="${r.pricePerDay}"></span> zÅ‚
    </p>

    <p th:if="${r.rentalType.name() == 'LONG_TERM'}">
        <b>Cena za miesiÄ…c:</b> <span th:text="${r.pricePerMonth}"></span> zÅ‚<br>
        <b>DzieÅ„ rozliczenia:</b> <span th:text="${r.billingDayOfMonth}"></span>
    </p>

    <p><b>Kaucja:</b> <span th:text="${r.deposit}"></span> zÅ‚</p>
    <p><b>Przebieg poczÄ…tkowy:</b> <span th:text="${r.startMileage}"></span> km</p>
    <p><b>Okres:</b>
        <span th:text="${r.startDate}"></span>
        â€“
        <span th:text="${r.endDate != null ? r.endDate : 'bezterminowo'}"></span>
    </p>
</div>

<hr>

<h2>ğŸ“œ Historia wypoÅ¼yczeÅ„</h2>

<table>
    <tr>
        <th>Data wypoÅ¼yczenia</th>
        <th>Data zwrotu</th>
        <th>Klient</th>
        <th>Typ</th>
        <th>Cena</th>
        <th>IloÅ›Ä‡</th>
        <th>WartoÅ›Ä‡ wypoÅ¼yczenia</th>  <!-- NOWA KOLUMNA -->
        <th>Status</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="r : ${rentals}">
        <td th:text="${r.startDate}"></td>
        <td th:text="${r.endDate} ?: 'â€”'"></td>
        <td th:text="${r.customer.firstName + ' ' + r.customer.lastName}"></td>
        <td>
            <span th:if="${r.rentalType == T(com.carrental.backend.model.RentalType).SHORT_TERM}">Dobowy</span>
            <span th:if="${r.rentalType == T(com.carrental.backend.model.RentalType).LONG_TERM}">MiesiÄ™czny</span>
        </td>
        <td>
        <span th:if="${r.rentalType == T(com.carrental.backend.model.RentalType).SHORT_TERM}"
              th:text="${r.pricePerDay} + ' zÅ‚/dzieÅ„'"></span>
            <span th:if="${r.rentalType == T(com.carrental.backend.model.RentalType).LONG_TERM}"
                  th:text="${r.pricePerMonth} + ' zÅ‚/mc'"></span>
        </td>
        <td>
        <span th:if="${r.rentalType == T(com.carrental.backend.model.RentalType).SHORT_TERM}"
              th:text="${r.days} + ' dÃ³b'"></span>
            <span th:if="${r.rentalType == T(com.carrental.backend.model.RentalType).LONG_TERM}"
                  th:text="${r.months} + ' miesiÄ™cy'"></span>
        </td>
        <td>  <!-- NOWA KOMÃ“RKA -->
            <strong style="color: green;"
                    th:text="${#numbers.formatCurrency(r.totalPrice)}"></strong>
        </td>
        <td>
            <span th:if="${r.returned}" style="color: green;">âœ… ZwrÃ³cony</span>
            <span th:if="${!r.returned}" style="color: orange;">ğŸ”„ Aktywny</span>
        </td>
</table>
<a th:href="@{'/panel/cars/' + ${car.id} + '/service'}">
    ğŸ›  KsiÄ…Å¼ka serwisowa
</a>
<div style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
    <a th:href="@{/panel/cars/__${car.id}__/edit}"
       style="display: inline-block; padding: 10px 20px; background-color: #007bff; color: white; text-decoration: none; border-radius: 4px;">
        âœï¸ Edytuj samochÃ³d
    </a>
</div>
<h3>ğŸ“ Notatki</h3>

<form th:action="@{'/panel/cars/' + ${car.id} + '/notes'}" method="post">
    <textarea name="content" required></textarea><br>
    <button type="submit">â• Dodaj notatkÄ™</button>
</form>

<ul>
    <li th:each="note : ${notes}">
        <span th:text="${note.content}"></span>
        <small th:text="${#temporals.format(note.createdAt, 'yyyy-MM-dd HH:mm')}"></small>

        <form th:action="@{'/panel/cars/' + ${car.id} + '/notes/' + ${note.id} + '/delete'}"
              method="post"
              style="display:inline">
            <button type="submit">ğŸ—‘</button>
        </form>
    </li>
</ul>

<br>
<a href="/panel/cars">â¬… PowrÃ³t do listy samochodÃ³w</a>

</body>
</html>
