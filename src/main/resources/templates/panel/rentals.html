<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Aktywne wypoÅ¼yczenia</title>
</head>
<body>
<nav style="margin-bottom:15px;">
  <a href="/panel/cars">ğŸš— Samochody</a> |
  <a href="/panel/customers">ğŸ‘¤ Klienci</a> |
  <a href="/panel/rentals">ğŸ“„ WypoÅ¼yczenia</a>
</nav>
<hr>
<h2>Aktywne wypoÅ¼yczenia</h2>
<!-- ğŸ” Pole wyszukiwania -->
<div class="search-box">
  <form method="get" th:action="@{/panel/rentals}">
    <label><strong>Wyszukaj po nazwisku klienta:</strong></label><br>
    <input type="text"
           name="search"
           class="search-input"
           placeholder="Wpisz nazwisko..."
           th:value="${search}">
    <button type="submit" class="search-btn">ğŸ” Szukaj</button>
    <a th:href="@{/panel/rentals}" class="clear-btn">âœ– WyczyÅ›Ä‡</a>
  </form>
</div>
<table border="1" cellpadding="6">
  <thead>
  <tr>
    <th>SamochÃ³d</th>
    <th>Rejestracja</th>
    <th>
      <a th:href="@{/panel/rentals(sortBy='customer.lastName', order=${order == 'asc' && sortBy == 'customer.lastName' ? 'desc' : 'asc'})}"
         class="sort-link"
         th:classappend="${sortBy == 'customer.lastName' ? (order == 'asc' ? 'sort-asc' : 'sort-desc') : ''}">
        Klient
      </a>
    </th>
    <th>
      <a th:href="@{/panel/rentals(sortBy='startDate', order=${order == 'asc' && sortBy == 'startDate' ? 'desc' : 'asc'})}"
         class="sort-link"
         th:classappend="${sortBy == 'startDate' ? (order == 'asc' ? 'sort-asc' : 'sort-desc') : ''}">
        Data wypoÅ¼yczenia
      </a>
    </th>
    <th>Data zwrotu</th>
    <th>Typ</th>
    <th>Cena</th>
    <th>IloÅ›Ä‡</th>
    <th>WartoÅ›Ä‡</th>
    <th>PDF</th>
    <th>Akcja</th>
  </tr>
  </thead>
  <tbody>  <!-- OTWARTY TBODY -->
  <tr th:each="r : ${rentals}">
    <td th:text="${r.car.brand + ' ' + r.car.model}"></td>
    <td th:text="${r.car.plateNumber}"></td>
    <td th:text="${r.customer.firstName + ' ' + r.customer.lastName}"></td>
    <td th:text="${r.startDate}"></td>
    <td th:text="${r.endDate} ?: 'â€”'"></td>
    <td>
      <span th:if="${r.rentalType == T(com.carrental.backend.model.RentalType).SHORT_TERM}">Dobowy</span>
      <span th:if="${r.rentalType == T(com.carrental.backend.model.RentalType).LONG_TERM}">MiesiÄ™czny</span>
    </td>
    <td>
      <span th:if="${r.rentalType == T(com.carrental.backend.model.RentalType).SHORT_TERM}"
            th:text="${r.pricePerDay} + ' zÅ‚/dzieÅ„'"></span>
      <span th:if="${r.rentalType == T(com.carrental.backend.model.RentalType).LONG_TERM}"
            th:text="${r.pricePerMonth} + ' zÅ‚/mc'"></span>
    </td>
    <td>
      <span th:if="${r.rentalType == T(com.carrental.backend.model.RentalType).SHORT_TERM}"
            th:text="${r.days} + ' dÃ³b'"></span>
      <span th:if="${r.rentalType == T(com.carrental.backend.model.RentalType).LONG_TERM}"
            th:text="${r.months} + ' miesiÄ™cy'"></span>
    </td>
    <td>
      <strong style="color: green;"
              th:text="${#numbers.formatCurrency(r.totalPrice)}"></strong>
    </td>
    <td>
      <a th:href="@{'/panel/rentals/' + ${r.id} + '/contract/pdf'}"
         target="_blank">ğŸ“„ PDF</a>
    </td>
    <td>
      <form th:if="${!r.returned}"
            th:action="@{'/panel/rentals/' + ${r.id} + '/return'}"
            method="post">
        <button type="submit">ğŸ”„ ZwrÃ³Ä‡ auto</button>
      </form>
    </td>
  </tr>
  </tbody>  <!-- âœ… DODANO ZAMKNIÄ˜CIE TBODY -->
</table>  <!-- âœ… PRZENIESIONO POZA TBODY -->

<br>
<a href="/panel/cars">â¬… PowrÃ³t do aut</a>
</body>
</html>