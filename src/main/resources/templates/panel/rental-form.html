<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>WypoÅ¼yczenie samochodu</title>
  <style>
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, select {
      margin-bottom: 10px;
      padding: 5px;
    }
    .price-section {
      margin: 15px 0;
      padding: 10px;
      background-color: #f5f5f5;
      border-radius: 5px;
    }
  </style>
</head>
<body>

<nav style="margin-bottom:15px;">
  <a href="/panel/cars">ğŸš— Samochody</a> |
  <a href="/panel/customers">ğŸ‘¤ Klienci</a> |
  <a href="/panel/rentals">ğŸ“„ WypoÅ¼yczenia</a>
</nav>

<hr>

<h1>ğŸ“„ WypoÅ¼ycz samochÃ³d</h1>

<!-- ğŸ”’ zabezpieczenie: jeÅ›li car == null, formularz siÄ™ nie renderuje -->
<div th:if="${car == null}">
  <p style="color:red;">
    âŒ BÅ‚Ä…d: nie wybrano samochodu
  </p>
  <a href="/panel/cars">â¬… WrÃ³Ä‡ do listy samochodÃ³w</a>
</div>

<!-- âœ… GÅÃ“WNY FORMULARZ -->
<div th:if="${car != null}">

  <h3>ğŸš— SamochÃ³d</h3>
  <ul>
    <li><b>Marka:</b> <span th:text="${car.brand}"></span></li>
    <li><b>Model:</b> <span th:text="${car.model}"></span></li>
    <li><b>Rejestracja:</b> <span th:text="${car.plateNumber}"></span></li>
    <li><b>VIN:</b> <span th:text="${car.vin}"></span></li>
  </ul>

  <hr>

  <form method="post" th:action="@{/panel/rentals/add}">

    <!-- ğŸ”‘ ID SAMOCHODU (UKRYTE) -->
    <input type="hidden" name="carId" th:value="${car.id}" />

    <!-- ğŸ‘¤ KLIENT -->
    <label>Klient:</label><br>
    <select name="customerId" required>
      <option value="">-- wybierz klienta --</option>
      <option th:each="c : ${customers}"
              th:value="${c.id}"
              th:text="${c.firstName + ' ' + c.lastName}">
      </option>
    </select>

    <br><br>

    <!-- ğŸ“„ TYP WYNAJMU -->
    <label>Rodzaj wynajmu:</label><br>
    <select name="rentalType" id="rentalType" required>
      <option value="SHORT_TERM">KrÃ³tkoterminowy</option>
      <option value="LONG_TERM">DÅ‚ugoterminowy</option>
    </select>

    <br><br>

    <label>Godzina odbioru</label>
    <input type="time" name="startTime" required>

    <label>Godzina zwrotu</label>
    <input type="time" name="endTime" required>

    <br><br>

    <h3>ğŸš— Dane samochodu</h3>

    <p><b>Marka:</b> <span th:text="${car.brand}"></span></p>
    <p><b>Model:</b> <span th:text="${car.model}"></span></p>
    <p><b>VIN:</b> <span th:text="${car.vin}"></span></p>
    <p><b>Rejestracja:</b> <span th:text="${car.plateNumber}"></span></p>

    <label>Przebieg poczÄ…tkowy</label>
    <input type="number" name="startMileage" required>

    <br><br>

    <h3>ğŸ“„ Parametry umowy</h3>

    <!-- KRÃ“TKOTERMINOWY -->
    <div id="shortTerm" class="price-section">
      <label>Cena za dobÄ™ (zÅ‚)</label>
      <input type="number" step="0.01" name="pricePerDay" required>
    </div>

    <!-- DÅUGOTERMINOWY -->
    <div id="longTerm" class="price-section" style="display:none;">
      <label>Cena za miesiÄ…c (zÅ‚)</label>
      <input type="number" step="0.01" name="pricePerMonth" required>

      <label>DzieÅ„ rozliczenia miesiÄ…ca (1-31)</label>
      <input type="number" min="1" max="31" name="billingDayOfMonth" value="1" required>
    </div>


    <label>Kaucja (zÅ‚)</label>
    <input type="number" step="0.01" name="deposit" required>

    <label>Data od</label>
    <input type="date" name="startDate" required>

    <label>Data do</label>
    <input type="date" name="endDate" required>

    <br><br>

    <button type="submit">âœ… Zapisz wypoÅ¼yczenie</button>
    <a href="/panel/cars" style="margin-left: 10px;">â¬… Anuluj</a>
  </form>

</div>

<script>
  const rentalTypeSelect = document.getElementById('rentalType');
  const shortTerm = document.getElementById('shortTerm');
  const longTerm = document.getElementById('longTerm');

  const pricePerDay = document.querySelector('input[name="pricePerDay"]');
  const pricePerMonth = document.querySelector('input[name="pricePerMonth"]');
  const billingDayOfMonth = document.querySelector('input[name="billingDayOfMonth"]');

  function updateVisibility() {
    if (rentalTypeSelect.value === 'SHORT_TERM') {
      shortTerm.style.display = 'block';
      longTerm.style.display = 'none';

      // WyÅ‚Ä…cz ukryte pola (przeglÄ…darka nie bÄ™dzie ich walidowaÄ‡)
      pricePerMonth.disabled = true;
      billingDayOfMonth.disabled = true;

      // WÅ‚Ä…cz widoczne pola
      pricePerDay.disabled = false;
    } else {
      shortTerm.style.display = 'none';
      longTerm.style.display = 'block';

      // WyÅ‚Ä…cz ukryte pola
      pricePerDay.disabled = true;

      // WÅ‚Ä…cz widoczne pola
      pricePerMonth.disabled = false;
      billingDayOfMonth.disabled = false;
    }
  }

  // NasÅ‚uchiwanie zmiany typu wypoÅ¼yczenia
  rentalTypeSelect.addEventListener('change', updateVisibility);

  // Inicjalizacja przy zaÅ‚adowaniu
  updateVisibility();
</script>
<!-- Flatpickr CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<!-- Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
  // Inicjalizacja date picker dla pola daty wypoÅ¼yczenia
  flatpickr("#rentalDate", {
      dateFormat: "d.m.Y",  // Format: dzieÅ„.miesiÄ…c.rok
      locale: "pl",         // Polski jÄ™zyk
      allowInput: true      // PozwÃ³l na rÄ™czne wpisywanie
  });

  // Inicjalizacja date picker dla pola daty zwrotu
  flatpickr("#returnDate", {
      dateFormat: "d.m.Y",
      locale: "pl",
      allowInput: true
  });
</script>
</body>
</html>